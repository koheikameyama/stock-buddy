"""
Python スクリプト共通定数

TypeScript側の lib/constants.ts と対応する値にはコメントで明記。
値を変更する場合は、対応するTS側の定数も確認すること。
"""

# =============================================================================
# OpenAI設定
# =============================================================================

OPENAI_MODEL = "gpt-4o-mini"
OPENAI_TEMPERATURE = 0.3
OPENAI_MAX_TOKENS_INSIGHT = 100
OPENAI_MAX_TOKENS_IMPROVEMENT = 200

# AI API同時リクエスト数の制限
AI_CONCURRENCY_LIMIT = 3

# =============================================================================
# 株価データ取得（※TS側 lib/constants.ts と同じ値）
# =============================================================================

# 株価取得失敗の警告閾値（上場廃止の可能性）
# → TS: FETCH_FAIL_WARNING_THRESHOLD
FETCH_FAIL_WARNING_THRESHOLD = 3

# 株価データの鮮度チェック（日数）: これより古いデータは無視
# → TS: STALE_DATA_DAYS
STALE_DATA_DAYS = 14

# =============================================================================
# バッチ処理
# =============================================================================

# yf.download() 1回あたりの最大銘柄数
DOWNLOAD_BATCH_SIZE = 500

# DB更新のバッチサイズ
DB_BATCH_SIZE = 100

# =============================================================================
# yfinance レート制限対策
# =============================================================================

# レート制限エラー時のリトライ回数
YFINANCE_RATE_LIMIT_MAX_RETRIES = 5

# リトライ間隔（秒）: 指数バックオフ
YFINANCE_RATE_LIMIT_WAIT_SECONDS = [30, 60, 120, 240, 480]

# バッチ間のスリープ時間（秒）: レート制限を避けるため
YFINANCE_BATCH_SLEEP_SECONDS = 3

# =============================================================================
# 業績データ取得
# =============================================================================

# 全銘柄を取得するのに何日かけるか
EARNINGS_ROTATION_DAYS = 7

# リクエスト間隔（秒）
EARNINGS_SLEEP_INTERVAL = 0.5

# =============================================================================
# データ保持・評価
# =============================================================================

# 古いデータの保持期間（日数）
RETENTION_DAYS = 30

# 推薦結果評価の対象日数
EVALUATION_DAYS = [1, 3, 7, 14]

# AI精度レポート: 推奨から何日後に評価するか
REPORT_EVALUATION_DELAY_DAYS = 7

# AI精度レポート: 1回のレポートで評価する日数（週次化時に7に変更）
REPORT_EVALUATION_WINDOW_DAYS = 1

# =============================================================================
# 価格アラート
# =============================================================================

# 急騰しきい値（%）
SURGE_THRESHOLD = 5.0

# 急落しきい値（%）
PLUNGE_THRESHOLD = -5.0

# =============================================================================
# 購入推奨
# =============================================================================

# 買い推奨通知の信頼度しきい値
BUY_RECOMMENDATION_CONFIDENCE_THRESHOLD = 0.6

# =============================================================================
# 日次上昇/下落ランキング
# =============================================================================

# 上昇/下落それぞれの銘柄数
MOVERS_COUNT = 5

# =============================================================================
# パフォーマンス評価の成功基準（%）
# =============================================================================

# おすすめ銘柄: 騰落率がこれより大きければ成功
DAILY_SUCCESS_THRESHOLD = -3

# 購入推奨 buy: 騰落率がこれより大きければ成功
PURCHASE_BUY_SUCCESS_THRESHOLD = -3

# 購入推奨 stay: 騰落率がこれ以下なら成功
PURCHASE_STAY_SUCCESS_THRESHOLD = 5

# 購入推奨 remove: 騰落率がこれ未満なら成功
PURCHASE_REMOVE_SUCCESS_THRESHOLD = 3

# ポートフォリオ分析 up: 騰落率がこれより大きければ成功
ANALYSIS_UP_SUCCESS_THRESHOLD = -3

# ポートフォリオ分析 down: 騰落率がこれ未満なら成功
ANALYSIS_DOWN_SUCCESS_THRESHOLD = 3

# ポートフォリオ分析 neutral: 騰落率がこの範囲内なら成功
ANALYSIS_NEUTRAL_SUCCESS_THRESHOLD = 5

# =============================================================================
# OpenAI使用量チェック
# =============================================================================

# 為替レート（円/ドル）
USD_TO_JPY = 150

# gpt-4o-mini料金（USD per 1M tokens）
GPT4O_MINI_PRICING = {"input": 0.15, "output": 0.60}
