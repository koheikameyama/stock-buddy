# 実装計画: 失敗したマイグレーションの解消

画像で確認された `applied_steps_count: 0` という状態は、マイグレーションが開始されたものの、何らかの理由で完了せず「失敗」として記録されていることを示しています。これにより、Prismaは「DBが不整合な状態である」と判断し、以降の操作をロックしています。

## ユーザーへの確認事項

> [!WARNING]
> 本番DBの `_prisma_migrations` テーブルのレコードを操作します。直接的なデータ損失のリスクは低いですが、慎重に進めます。
> また、`package.json` の `build` スクリプトへの `prisma migrate deploy` 追加を戻された件について、デプロイ時に自動実行されない設定になっているため、手動でコマンドを叩く必要があります。

## 解決手順

### 1. 失敗したレコードの解消

Prismaに対し、このマイグレーションが「ロールバックされた（適用されていない）」状態であることを通知し、レコードをクリーンアップします。

```bash
npx prisma migrate resolve --rolled-back 20260222093458_add_investment_style
```

### 2. 再適用

クリーンアップ後、改めてマイグレーションを適用します。これにより、実際にSQLが実行されます。

```bash
npx prisma migrate deploy
```

## 検証計画

### 自動テスト

- `npx prisma migrate status` を実行し、"Database is up to date" と表示されることを確認します。

### 手動確認

- ダッシュボードページにアクセスし、エラーが解消されていることを確認します。
