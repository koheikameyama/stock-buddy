# データベース不要テーブル調査レポート

データベース（`prisma/schema.prisma`）に定義されている全テーブルのコード内での使用状況を調査しました。

## 調査結果サマリー

結論から申し上げますと、**`WeeklyAIReport` 以外のほぼ全てのテーブルは現在何らかの機能やバッチ処理で使用されています。**

### 各テーブルの使用状況

| カテゴリ               | テーブル名                                                                 | 使用状況・用途                                                                                                                              |
| :--------------------- | :------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| **認証・ユーザー**     | `User`, `Account`, `Session`, `UserSettings`                               | NextAuthによる認証およびユーザー設定の保持に使用しています（必須）。                                                                        |
| **銘柄関連**           | `Stock`, `WatchlistStock`, `PortfolioStock`, `TrackedStock`, `Transaction` | 銘柄マスタ、ウォッチリスト、ポートフォリオ、取引履歴。アプリのコア機能です。                                                                |
| **AI分析（個別）**     | `StockAnalysis`, `PurchaseRecommendation`, `UserDailyRecommendation`       | ポートフォリオ分析、購入判断、今日のおすすめ銘柄に使用されています。                                                                        |
| **AI分析（全体）**     | `PortfolioOverallAnalysis`, `RecommendationOutcome`, `PortfolioSnapshot`   | ポートフォリオ総評、精度検証、資産推移の記録に使用されています。                                                                            |
| **レポート・統計**     | `DailyAIReport`, `DailyMarketMover`, `DailyFeaturedStock`                  | AI精度の集計、値上がり・値下がり要因分析、注目銘柄に使用されています。                                                                      |
| **ニュース・トレンド** | `MarketNews`, `SectorTrend`                                                | ニュース収集、セクタートレンド算出に使用されています。                                                                                      |
| **通知・リクエスト**   | `Notification`, `PushSubscription`, `StockRequest`                         | アプリ内・プッシュ通知、ユーザーからの銘柄追加リクエストに使用されています。                                                                |
| **【要確認】**         | `WeeklyAIReport`                                                           | **コード内での使用が確認できませんでした。** `DailyAIReport` に役割が移っているか、将来用として定義されたままの実装待ちの状態と思われます。 |

## 詳細分析：`WeeklyAIReport` について

- **現状**: スキーマ定義とマイグレーションには存在しますが、コード（`lib/`, `app/`, `scripts/`）内でインポートや参照されている箇所が一件もありませんでした。
- **背景**: 2026-02-17付の設計ドキュメントでは「週次レポートとして維持する」とありましたが、その後の 2026-02-19 に `DailyAIReport` テーブルが追加され、現在の集計スクリプト（`generate_recommendation_report.py`）は `DailyAIReport` の方を更新しています。
- **結論**: 現時点では削除しても動作に支障はありませんが、将来的に週単位のアーカイブを残したい場合は保存しておくという選択肢もあります。

## 推奨アクション

1. **`WeeklyAIReport` の削除**: 不要な定義を整理したい場合は、削除を検討してください。
2. **その他テーブルの維持**: 上記以外のテーブルは現在稼働中の機能やバッチで使用されているため、維持を推奨します。

> [!NOTE]
> `StockRequest` や `DailyMarketMover` など、UI上あまり目立たない箇所も、バックグラウンドの集計スクリプトや特定のAPIエンドポイントでしっかりと使用されていました。
