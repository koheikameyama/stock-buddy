# マイ銘柄ページのタブ分離とUI改善設計

## 概要

現在の`/my-stocks`ページは保有銘柄と気になる銘柄が混在表示されており、それぞれに必要な情報が異なるため、以下の改善を行う。

### 主な変更点

1. **タブで分離** - 保有銘柄と気になる銘柄を標準的なタブUIで切り替え表示
2. **カードをシンプル化** - 現在の詳細情報（予測、分析など）は詳細ページへ移動
3. **カード全体をクリッカブルに** - カードをクリックすると詳細ページ（`/my-stocks/:id`）へ遷移
4. **詳細ページの新規作成** - マイ銘柄専用の詳細ページで、評価損益メイン + 簡単な購入履歴を表示

### ターゲットユーザー

- 投資初心者がひと目で「儲かってる？」「次に何すべき？」を理解できる
- 情報を詰め込みすぎず、必要に応じて詳細ページで深掘りできる構造

## UI設計

### 1. `/my-stocks` リストページ

#### タブUI

```
┌─────────────────────────────────────┐
│ マイ銘柄                             │
│ 気になる銘柄と保有銘柄を一覧管理      │
├─────────────────────────────────────┤
│ [保有銘柄 (3)] | 気になる銘柄 (2)     │← タブ（アクティブは太字+下線）
├─────────────────────────────────────┤
│ 現在 3/5 銘柄              [+ 追加]   │
└─────────────────────────────────────┘
```

#### 保有銘柄カード

```
┌─────────────────────────────────────┐
│ トヨタ自動車 (7203)                  │← クリッカブル（全体）
│ 自動車・輸送機                       │
│                                     │
│ 現在価格: ¥2,850                    │
│ 保有: 100株                         │
│ 評価損益: +¥5,000 (+10.5%) ✨      │← 緑/赤色
└─────────────────────────────────────┘
```

**表示項目:**
- 必須: 銘柄名、ティッカー、セクター
- 現在価格
- 保有数
- 評価損益（金額・率）

**表示しない項目（詳細ページへ）:**
- 平均取得単価
- 評価額
- 前日比
- AI予測・分析
- 編集・削除ボタン

#### 気になる銘柄カード

```
┌─────────────────────────────────────┐
│ ソニーグループ (6758)                │← クリッカブル（全体）
│ 電気機器                            │
│                                     │
│ 現在価格: ¥13,500                   │
│ 前日比: +2.3% ↗                    │← 緑/赤色
│                                     │
│ 💰 買い時です！                     │← AI判断（大きく）
└─────────────────────────────────────┘
```

**表示項目:**
- 必須: 銘柄名、ティッカー、セクター
- 現在価格
- 前日比
- AI購入判断（簡易版）

**表示しない項目（詳細ページへ）:**
- 推奨購入価格
- 詳細なAI分析
- 予測情報
- 編集・削除ボタン

### 2. `/my-stocks/:id` 詳細ページ

#### 保有銘柄の詳細ページ

```
┌─────────────────────────────────────┐
│ ← 戻る                              │
│                                     │
│ トヨタ自動車 (7203)                  │
│ [保有中]                            │
├─────────────────────────────────────┤
│ 【現在の状況】                       │
│ 現在価格: ¥2,850 (+1.2%)           │
│ 保有数: 100株                       │
│ 平均取得単価: ¥2,500                │
│ 評価額: ¥285,000                    │
│ 評価損益: +¥35,000 (+14.0%) 🎉    │← 大きく表示
├─────────────────────────────────────┤
│ 【購入履歴】                         │
│ ・2024/01/15: 50株 @ ¥2,400       │
│ ・2024/02/20: 50株 @ ¥2,600       │
├─────────────────────────────────────┤
│ 【AI売買判断】                       │
│ 📊 ホールド推奨                     │
│ （StockPredictionコンポーネント）    │
│ （PortfolioAnalysisコンポーネント） │
├─────────────────────────────────────┤
│ [追加購入] [売却] [編集] [削除]      │
└─────────────────────────────────────┘
```

**セクション構成:**
1. **現在の状況**: 価格、保有数、平均取得単価、評価額、評価損益
2. **購入履歴**: Transactionテーブルから取得（日付、数量、価格）
3. **AI売買判断**: 既存のStockPrediction、PortfolioAnalysisコンポーネントを再利用
4. **アクションボタン**: 追加購入、売却、編集、削除

#### 気になる銘柄の詳細ページ

```
┌─────────────────────────────────────┐
│ ← 戻る                              │
│                                     │
│ ソニーグループ (6758)                │
│ [気になる]                          │
├─────────────────────────────────────┤
│ 【現在の価格】                       │
│ 現在価格: ¥13,500 (+2.3%)          │
│ 52週高値/安値: ¥15,000 / ¥11,000   │
├─────────────────────────────────────┤
│ 【AI購入判断】                       │
│ 💰 買い時です！                     │
│ 推奨購入価格: ¥13,000〜¥13,500     │
│ （PurchaseRecommendationコンポーネント）│
│ （StockPredictionコンポーネント）    │
├─────────────────────────────────────┤
│ [今すぐ購入] [編集] [削除]          │
└─────────────────────────────────────┘
```

**セクション構成:**
1. **現在の価格**: 現在価格、前日比、52週高値/安値
2. **AI購入判断**: 既存のPurchaseRecommendation、StockPredictionコンポーネントを再利用
3. **アクションボタン**: 今すぐ購入、編集、削除

## データ設計

### データベース

既存のテーブル構造をそのまま利用（変更なし）:

- **WatchlistStock**: 気になる銘柄
  - `addedReason`, `alertPrice`, `note`

- **PortfolioStock**: 保有銘柄
  - `quantity`, `averagePurchasePrice`, `purchaseDate`, `note`
  - リレーション: `transactions`

- **Transaction**: 取引履歴
  - `type` ("buy" | "sell")
  - `quantity`, `price`, `totalAmount`, `transactionDate`

### API

既存のAPIをそのまま利用（変更なし）:

- `GET /api/user-stocks?mode=all` - 全ユーザー銘柄取得
- `GET /api/user-stocks/:id` - 個別銘柄取得（詳細ページ用）
- `PATCH /api/user-stocks/:id` - 編集
- `DELETE /api/user-stocks/:id` - 削除

## 実装アプローチ

### 段階的リファクタリング（推奨）

**メリット:**
- 各ステップで動作確認できる
- 既存機能を壊しにくい
- 問題が起きても切り戻しやすい

### Phase 1: タブUI追加

**変更ファイル:**
- `app/my-stocks/MyStocksClient.tsx`

**変更内容:**
- `activeTab` ステート追加（`"portfolio"` | `"watchlist"`）
- タブUIコンポーネント追加
- 表示銘柄をタブで切り替え
- 既存のカード表示ロジックはそのまま維持

**実装イメージ:**
```typescript
const [activeTab, setActiveTab] = useState<"portfolio" | "watchlist">("portfolio")

const portfolioStocks = userStocks.filter(s => s.type === "portfolio")
const watchlistStocks = userStocks.filter(s => s.type === "watchlist")

const displayStocks = activeTab === "portfolio" ? portfolioStocks : watchlistStocks
```

**タブUIコンポーネント:**
```tsx
<div className="flex border-b border-gray-200 mb-6">
  <button
    onClick={() => setActiveTab("portfolio")}
    className={`px-6 py-3 font-semibold ${
      activeTab === "portfolio"
        ? "border-b-2 border-blue-600 text-blue-600"
        : "text-gray-500 hover:text-gray-700"
    }`}
  >
    保有銘柄 ({portfolioStocks.length})
  </button>
  <button
    onClick={() => setActiveTab("watchlist")}
    className={`px-6 py-3 font-semibold ${
      activeTab === "watchlist"
        ? "border-b-2 border-blue-600 text-blue-600"
        : "text-gray-500 hover:text-gray-700"
    }`}
  >
    気になる銘柄 ({watchlistStocks.length})
  </button>
</div>
```

### Phase 2: カードのシンプル化

**変更ファイル:**
- `app/my-stocks/StockCard.tsx`

**変更内容:**
- 予測・分析ボタンとコンポーネントを削除
- 編集・削除・変換ボタンを削除
- カードデザインをシンプルに
- まだクリック機能は追加しない（Phase 3で実装）

**保有銘柄カード表示項目:**
- 銘柄名、ティッカー、セクター
- 現在価格
- 保有数
- 評価損益（金額・率、色付き）

**気になる銘柄カード表示項目:**
- 銘柄名、ティッカー、セクター
- 現在価格
- 前日比（色付き）
- AI購入判断（簡易版: "買い時です！" / "様子見" など）

### Phase 3: 詳細ページ作成

**新規ファイル:**
- `app/my-stocks/[id]/page.tsx` - サーバーコンポーネント
- `app/my-stocks/[id]/MyStockDetailClient.tsx` - クライアントコンポーネント

**機能:**

**保有銘柄:**
- 現在の状況セクション（価格、保有数、平均取得単価、評価額、評価損益）
- 購入履歴セクション（Transactionテーブルから取得）
- AI売買判断セクション（StockPrediction、PortfolioAnalysisコンポーネント再利用）
- アクションボタン（追加購入、売却、編集、削除）

**気になる銘柄:**
- 現在の価格セクション（価格、前日比、52週高値/安値）
- AI購入判断セクション（PurchaseRecommendation、StockPredictionコンポーネント再利用）
- アクションボタン（今すぐ購入、編集、削除）

### Phase 4: カードをクリッカブルに変更

**変更ファイル:**
- `app/my-stocks/StockCard.tsx`

**変更内容:**
- カード全体を`<Link>`または`onClick`でラップ
- ホバー時のスタイル追加（shadow、背景色変更、カーソルpointerなど）
- `/my-stocks/${stock.id}` へ遷移
- アクセシビリティ対応（role="button", tabindex等）

## 設計原則

### YAGNI（You Aren't Gonna Need It）

- 追加購入のシミュレーション機能は実装しない（必要になってから）
- 詳細な財務指標の表示は実装しない（初心者には不要）
- フィルター・ソート機能は実装しない（5銘柄制限なので不要）

### 初心者向け設計

- 専門用語を避ける（「評価損益」は残すが、「PER」「PBR」は使わない）
- 視覚的に理解しやすい（色、アイコン、絵文字を活用）
- 次のアクションが明確（「買い時です！」「ホールド推奨」など）

### 保守性

- 既存コンポーネント（StockPrediction、PurchaseRecommendation、PortfolioAnalysis）を再利用
- 段階的なリファクタリングで既存機能を壊さない
- 各Phaseで動作確認してから次へ進む

## 受け入れ条件

### Phase 1
- [ ] タブUIが表示される
- [ ] タブクリックで保有銘柄/気になる銘柄が切り替わる
- [ ] 既存のカード機能（編集、削除、予測表示等）がすべて動作する

### Phase 2
- [ ] カードがシンプルになり、必要な情報のみ表示される
- [ ] 保有銘柄カードに評価損益が色付きで表示される
- [ ] 気になる銘柄カードにAI購入判断が表示される

### Phase 3
- [ ] `/my-stocks/:id` で詳細ページが表示される
- [ ] 保有銘柄の詳細ページに購入履歴が表示される
- [ ] AI予測・分析が詳細ページで表示される
- [ ] 編集・削除・追加購入等のアクションが機能する

### Phase 4
- [ ] カード全体がクリッカブルになる
- [ ] カードホバー時に視覚的フィードバックがある
- [ ] クリックで詳細ページへ正しく遷移する

## 補足

### 追加購入について

当初「追加購入の表示を工夫したい」という要件があったが、初心者にとって重要なのは「今、儲かってる？」であり、詳細な取引履歴や平均単価の計算ロジックは二の次と判断。

**実装方針:**
- 詳細ページに簡単な購入履歴を表示（日付、数量、価格）
- 初心者でも自分の行動を振り返れる程度の情報
- 複雑な平均単価シミュレーションは実装しない（YAGNI）

### デザインシステム

既存のTailwind CSS + カラースキームを踏襲:
- 保有銘柄: 青系（`bg-blue-600`, `text-blue-700`）
- 気になる銘柄: 琥珀系（`bg-amber-100`, `text-amber-700`）
- プラス損益: 緑系（`text-green-600`）
- マイナス損益: 赤系（`text-red-600`）
