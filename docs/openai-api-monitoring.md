# OpenAI API 使用量モニタリング

## 概要

OpenAI APIのコストを管理し、予算超過を防ぐための運用フロー。

**監視対象**: Stock Buddyプロジェクト専用（`proj_Pnbj8J65ZaUns8dBvvki1qTG`）

## 予算設定

- **月次予算**: $10（約¥1,480）
- **アラート閾値**:
  - 50%到達: $5（約¥740）
  - 80%到達: $8（約¥1,184）
  - 100%到達: $10（約¥1,480）

## 週次チェック手順

### 毎週月曜日 10:00

1. **OpenAI Dashboardで使用量を確認**
   - URL: https://platform.openai.com/usage
   - 今月の累計使用量をチェック
   - 前週比の増減を確認

2. **使用量の記録**
   - 日付
   - 累計使用量（$）
   - 前週比（%）
   - API呼び出し回数

3. **予算進捗の確認**
   ```
   現在の使用量 / 月次予算 = 使用率

   例:
   $25 / $50 = 50%
   ```

4. **必要に応じてアクション**
   - **50%未満**: 問題なし
   - **50-80%**: 注意深く監視
   - **80%以上**: 緊急対応（AI分析頻度を下げる等）

## アラート対応フロー

### 80%到達時（$40）

1. **原因調査**
   - どのAPIエンドポイントで使用量が多いか確認
   - ユーザー数の増加が原因か確認

2. **対策検討**
   - AI分析頻度を下げる（毎日→週1回）
   - プロンプトを最適化して使用トークンを削減

3. **Linearタスク作成**
   - 緊急対応タスクとして登録

### 100%到達時（$50）

1. **即座に対応**
   - AI分析を一時停止（オプション）
   - ユーザーに通知

2. **追加予算の検討**
   - 予算を$100に増額するか判断
   - 収益とのバランスを確認

## 使用量記録テンプレート

```markdown
## 2026年2月 Week 1（2/3-2/9）

- **累計使用量**: $X.XX
- **前週比**: +Y%
- **API呼び出し回数**: Z回
- **使用率**: XX%

### 特記事項
- （必要に応じて記載）

### アクション
- （必要に応じて記載）
```

## モニタリングスクリプト（将来実装）

将来的にはスクリプトで自動監視を実装：

```typescript
// app/api/monitoring/openai-usage/route.ts
// OpenAI API使用量を取得してSlackに通知
```

## 関連ドキュメント

- [収益化戦略](./monetization-strategy.md)
- [コスト分析](./cost-analysis.md)
- [Linear KOH-100](https://linear.app/koheikameyama/issue/KOH-100)

## 改訂履歴

| 日付 | 内容 |
|------|------|
| 2026-01-31 | 初版作成 |
