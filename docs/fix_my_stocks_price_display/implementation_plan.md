# 銘柄移行スクリプトのレート制限耐性強化の計画

## 概要

大量の銘柄を一度に処理する `migrate-existing-tickers.ts` において、Yahoo Finance のレート制限によるエラーでスキップが発生しないよう、リトライロジックとスリープを追加します。また、方針変更に伴い東証（.T）のみを対象とするように修正します。

## ユーザーレビューが必要な項目

- 特になし

## 提案される変更

### [Component: Scripts]

#### [MODIFY] [migrate-existing-tickers.ts](file:///Users/kouheikameyama/development/stock-buddy/scripts/migrate-existing-tickers.ts)

- **クエリの修正**: 名証（`.NG`, `.NX`）の検索を削除し、サフィックスがない銘柄のみを抽出対象にします。
- **リトライロジックの導入**: `fetchStockPrices` 呼び出し時に、レート制限エラー（429等）が発生した際、最大5回程度のリトライ（指数バックオフ付き）を行う関数を追加します。
- **バッチ間のスリープ**: 各バッチの処理完了後に、`YFINANCE_BATCH_SLEEP_SECONDS`（通常30秒程度）の間スリープし、アクセス密度を下げます。

## 検証計画

### 手動検証

- スクリプトを実行し、ログから以下の点を確認します：
  - バッチ間にスリープが挟まっていること
  - 仮にエラーが発生しても即座にスキップせず、待機後にリトライしていること
